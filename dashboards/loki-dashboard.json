{
  "schemaVersion": 27,
  "title": "Loki Logs & Aggregation - Enterprise",
  "uid": "loki-logs",
  "tags": ["loki", "logs", "vmstation", "enterprise"],
  "timezone": "browser",
  "editable": true,
  "refresh": "30s",
  "time": {"from": "now-1h", "to": "now"},
  "templating": {"list": [{"name": "namespace", "label": "Namespace", "type": "query", "datasource": "Loki", "query": "label_values(namespace)", "multi": true, "includeAll": true, "refresh": 1}]},
  "panels": [
    {
      "id": 1,
      "title": "Loki Service Status",
      "type": "stat",
      "datasource": "Prometheus",
      "gridPos": {"h": 3, "w": 4, "x": 0, "y": 0},
      "targets": [{"expr": "up{job=\"loki\"}", "refId": "A"}],
      "fieldConfig": {"defaults": {"mappings": [{"options": {"0": {"text": "Down", "color": "red"}, "1": {"text": "Healthy", "color": "green"}}, "type": "value"}], "color": {"mode": "thresholds"}, "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": null}, {"color": "green", "value": 1}]}}},
      "options": {"colorMode": "background", "graphMode": "none", "orientation": "auto", "textMode": "value"}
    },
    {
      "id": 2,
      "title": "Log Volume by Namespace",
      "type": "timeseries",
      "datasource": "Loki",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 3},
      "targets": [{"expr": "sum by (namespace) (rate({job=~\".+\", namespace=~\"$namespace\"}[1m]))", "refId": "A"}],
      "fieldConfig": {"defaults": {"unit": "logs/sec", "color": {"mode": "palette-classic"}, "custom": {"drawStyle": "bars", "fillOpacity": 80, "lineWidth": 0, "showPoints": "never", "stacking": {"mode": "normal"}}}},
      "options": {"legend": {"displayMode": "table", "placement": "right", "calcs": ["mean", "max"]}}
    },
    {
      "id": 3,
      "title": "Application Logs (Filtered)",
      "type": "logs",
      "datasource": "Loki",
      "gridPos": {"h": 12, "w": 24, "x": 0, "y": 11},
      "targets": [{"expr": "{job=~\".+\", namespace=~\"$namespace\"} | namespace !~ \"kube-system|kube-flannel|monitoring\"", "refId": "A"}],
      "options": {"showTime": true, "showLabels": true, "showCommonLabels": false, "wrapLogMessage": true, "dedupStrategy": "none", "enableLogDetails": true, "prettifyLogMessage": false, "sortOrder": "Descending"}
    }
  ],
  "version": 1
}
